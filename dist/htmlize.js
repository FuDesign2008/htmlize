!function(a){"use strict";var b=a.define,c="htmlize/htmlize",d="htmlize",e={},f=function(a){return"[object Function]"===Object.prototype.toString.call(a)},g=function(a){var b=e[a];if(!b)throw new Error("Module "+a+" is not defined.");return b.inited===!1&&h(a),b.ret},h=function(b){var c,d={},h=e[b],i=h.factory;f(i)?(c=i.apply(a,[g,d,void 0]),h.ret=void 0===c?d:c):h.ret=i,h.inited=!0},i=function(a,b,d){if(e[a])throw new Error("Module "+a+" has been defined already.");f(b)&&(d=b),e[a]={factory:d,inited:!1},a===c&&h(a)};i("core/console",function(){var a,b=this,c=function(){},d={DEBUG:!1,EXPORTS:b.JTK_EXPORTS||{},log:c,warn:c,error:c};if(b.DEBUG!==!0)return d;if(!b.console||!b.console.log)return d;a=b.console,d.DEBUG=!0;try{d.log=a.log.bind(a),d.warn=a.warn.bind(a),d.error=a.error.bind(a)}catch(e){d.log=function(){var b,c=[],d=arguments.length;for(b=0;d>b;b++)c.push(String(arguments[b]));a.log(c.join(";"))},d.warn=function(a,b){var c=this;if(b=b?"["+b+"]":"",c.log(b+"WARN: "+a+"."),"object"==typeof a)throw a},d.error=function(a,b){var c=this;if(b=b?"["+b+"]":"",c.log(b+"ERROR: "+a+"!"),"object"==typeof a)throw a}}return d}),i("core/str/startsWith",function(){return function(a,b){return""===b?!0:null==a||null==b?!1:0===String(a).indexOf(String(b))}}),i("core/str/times",function(){return function(a,b){return null==a||""===a||isNaN(b)?"":1>b?"":new Array(b+1).join(String(a))}}),i("core/str/trim",function(){return function(a){return null==a||""===a?"":String(a).replace(/^[\s\t\xA0\u3000]+/,"").replace(/[\s\t\xA0\u3000]+$/,"")}}),i("core/underscore",function(a){var b=a("core/console"),c=this._||this.underscore;return c?(b.EXPORTS.underscore===!1&&c.noConflict&&(c=c.noConflict()),c):void b.error("no underscore library","underscore.js")}),i("htmlize/parse",function(a){var b=a("core/str/trim"),c=a("core/str/startsWith"),d=a("core/underscore"),e=function(a){var b,c,d,e=/^[\s\t\xA0\u3000]+/.exec(a),f=0;if(!e)return 1;for(e=e[0],c=e.length,b=0;c>b;b++)d=e.charAt(b),f+="	"===d?4:1;return f=Math.ceil(f/4)+1,1>f?1:f},f=function(a,b){var c,e=[],f=0;return d.each(b,function(b){var c=a.substring(f,b.index),g='<a href="'+d.escape(b.full)+'">'+d.escape(b.text)+"</a>";c&&c.length&&e.push({content:c,plain:!0}),e.push({content:g,plain:!1}),f=b.index+b.size}),c=a.substring(f),c&&c.length&&e.push({content:c,plain:!0}),e&&e.length?e:[{content:a,plain:!0}]},g=function(a){a+="";var b,d,e,g=/(https?:\/\/|www\.|ssh:\/\/|ftp:\/\/)[a-z0-9&_+\-\?\/\.=\#,:]+/gi;for(d=[],b=g.exec(a);b;)e=b[0],d.push({index:b.index,size:e.length,text:e,full:c(e.toLowerCase(),"www.")?"http://"+e:e}),b=g.exec(a);return d&&d.length?f(a,d):[{content:a,plain:!0}]},h=function(a){a+="";var b,c,d,e=/[a-z0-9_+\-\.]+@[a-z0-9_+\-\.]+/gi;for(c=[],b=e.exec(a);b;)d=b[0],c.push({index:b.index,size:d.length,text:d,full:"mailto:"+d}),b=e.exec(a);return c&&c.length?f(a,c):[{content:a,plain:!0}]},i=function(a,b){a=d.flatten(a);var c=[];return d.each(a,function(a){a&&a.content&&c.push(a.plain?b(a.content):a)}),c=d.flatten(c)};return{blankLine:function(a){var c=b(a);return c?void 0:[{content:"<br/>",plain:!1}]},horizotalLine:function(a){var b=/^\s*-{3,}\s*$/;return b.test(a)?[{content:"<hr/>",plain:!1}]:void 0},inline:function(a){a+="";var b=[{content:a,plain:!0}];return b=i(b,g),b=i(b,h)},orderList:function(a,c){c=c!==!1;var f,g,h,i,j,k=this,l=b(a),m=c?/\d+\.?\s+/:/[-*]\s+/,n=m.exec(l);if(n)return h=e(a),g=[{content:"<li>",plain:!1,level:h,orderList:c}],f=n[0],i=l.substring(f.length),j=k.inline(i),g.push(j?j:{content:i,plain:!0}),g.push({content:"</li>",plain:!1}),d.flatten(g)},unorderList:function(a){var b=this;return b.orderList(a,!1)}}}),i("htmlize/htmlize",function(a){var b,c=a("core/underscore"),d=a("htmlize/parse"),e=a("core/str/times"),f=a("core/console");return b=function(a){var b,g,h,i,j,k,l,m,n,o,p="",q=[],r=0,s=function(a){if(!a||!a[0])return!1;var b=a[0];return!b||b.plain?!1:/<li>/i.test(b.content)?{level:b.level,orderList:b.orderList}:!1};if(!a)return"";for(b=a.split(/\r?\n/),g=c.map(b,function(a){return d.blankLine(a)||d.horizotalLine(a)||d.unorderList(a)||d.orderList(a)||d.inline(a)||[{content:a,plain:!0}]}),i=g.length,o=function(a){var b;a&&a.content&&(a.plain?(b=c.escape(a.content).replace(/ /g,"&nbsp;"),b=b.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),p+=b):p+=a.content)},h=0;i>h;h++)if(j=g[h],l=s(j))if(l.level===r)f.log("level == currentLevel",j),c.each(j,o);else if(l.level>r)f.log("level > currentLevel",j),m=l.orderList?"ol":"ul",n=l.level-r,p+=e("<"+m+">",n),c.each(j,o),q.push(e("</"+m+">",n)),r=l.level;else{for(f.log("level < currentLevel",j),n=r-l.level;n>0;)p+=q.pop()||"",n--;r=l.level,c.each(j,o)}else{if(r)for(k=q.pop();k;)p+=k,k=q.pop();p+="<div>",c.each(j,o),p+="</div>",r=0}return p},{htmlize:b}}),a[d]=g(c),"function"==typeof b&&b.amd&&b(d,[],function(){return g(c)})}(this);